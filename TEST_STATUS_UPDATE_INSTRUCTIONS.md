# تعليمات اختبار تحديث حالة الشكوى

## المشكلة الأصلية
عند تعديل حالة الشكوى في صفحة `status.html`، لا يظهر هذا التعديل في واجهة `general-complaints.html`.

## الحل المطبق

### 1. تحسينات في `general-complaints.js`:
- إضافة حفظ البيانات في `localStorage` باسم `complaintsData`
- تحسين مراقبة التحديثات من `localStorage`
- إضافة مراقبة إضافية عند التركيز على النافذة
- تحسين آلية التحديث في الواجهة

### 2. تحسينات في `status.js`:
- إضافة إزالة البيانات المؤقتة بعد التحديث
- تحسين آلية إرسال الإشعارات للصفحات الأخرى

### 3. آلية التحديث الجديدة:
1. عند تحديث الحالة في `status.html`، يتم حفظ التحديث في `localStorage`
2. يتم إرسال إشعار عبر `complaintStatusUpdated` في `localStorage`
3. `general-complaints.html` يراقب هذه التحديثات ويحدث الواجهة تلقائياً

## كيفية الاختبار

### الخطوة 1: فتح ملف الاختبار
افتح ملف `test-status-update.html` في المتصفح

### الخطوة 2: محاكاة التحديث
1. اضغط على زر "محاكاة تحديث الحالة إلى قيد المراجعة"
2. راقب التغييرات في القسم الثاني
3. اضغط على زر "محاكاة تحديث الحالة إلى تم الحل"

### الخطوة 3: اختبار الواجهة
1. اضغط على زر "فتح صفحة الشكاوى العامة"
2. في الصفحة الجديدة، راقب ما إذا كانت الحالة تتحدث تلقائياً

### الخطوة 4: اختبار التحديث الفعلي
1. اذهب إلى صفحة `general-complaints.html`
2. اختر شكوى واضغط على "تغيير الحالة"
3. في صفحة `status.html`، قم بتغيير الحالة
4. عد إلى صفحة `general-complaints.html` وتأكد من تحديث الحالة

## مؤشرات النجاح

### في ملف الاختبار:
- يجب أن تظهر رسائل نجاح في سجل الأحداث
- يجب أن تتحدث البيانات في localStorage
- يجب أن تتحدث الحالة المعروضة

### في التطبيق الفعلي:
- عند تغيير الحالة في `status.html`، يجب أن تتحدث الواجهة في `general-complaints.html` تلقائياً
- يجب أن تظهر الحالة الجديدة بدون الحاجة لإعادة تحميل الصفحة

## استكشاف الأخطاء

### إذا لم تعمل التحديثات:
1. تأكد من أن الخادم يعمل على المنفذ 3001
2. تحقق من وحدة تحكم المتصفح للأخطاء
3. تأكد من أن localStorage يعمل في المتصفح
4. تحقق من أن جميع الملفات محملة بشكل صحيح

### إذا لم تظهر التحديثات في الواجهة:
1. تحقق من أن دالة `updateComplaintStatusInUI` تعمل
2. تأكد من أن البيانات في `complaintsData` صحيحة
3. تحقق من أن `updateComplaintsDisplay` يتم استدعاؤها

## ملاحظات تقنية

### آلية المراقبة:
- يتم استخدام `window.addEventListener('storage')` لمراقبة التغييرات بين النوافذ
- يتم استخدام `setInterval` لمراقبة التحديثات في نفس النافذة
- يتم استخدام `window.addEventListener('focus')` لمراقبة التحديثات عند العودة للنافذة

### إدارة البيانات:
- البيانات محفوظة في `localStorage` باسم `complaintsData`
- إشعارات التحديث محفوظة باسم `complaintStatusUpdated`
- يتم تنظيف البيانات المؤقتة تلقائياً بعد 5-30 ثانية

### التوافق:
- يعمل مع جميع المتصفحات الحديثة
- يدعم التحديث في الوقت الفعلي
- يحافظ على الأداء من خلال التحديثات الذكية
