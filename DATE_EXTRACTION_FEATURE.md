# ميزة استخراج التاريخ من ملف الإكسل

## نظرة عامة
تم إضافة ميزة جديدة لاستخراج التاريخ تلقائياً من أول سطر في ملف الإكسل المرفوع، بدلاً من استخدام التاريخ الثابت "لسنة 2024 شهر أكتوبر".

## التحديثات المطبقة

### 1. في ملف `secret-visitor.js`

#### إضافة متغير لتخزين تاريخ التقرير:
```javascript
let reportDate = ''; // سيتم ملؤه من ملف الإكسل
```

#### إضافة دالة استخراج التاريخ:
```javascript
function extractDateFromFirstRow(rawData) {
    // البحث عن أنماط التاريخ العربية والإنجليزية في أول سطر
    // إرجاع التاريخ المستخرج أو القيمة الافتراضية
}
```

#### تحديث دالة حفظ البيانات:
```javascript
function saveToLocal() {
    const payload = {
        // ... البيانات الأخرى
        reportDate: reportDate, // إضافة تاريخ التقرير
        ts: Date.now()
    };
    // ...
}
```

#### تحديث دالة تحميل البيانات:
```javascript
function loadFromLocal() {
    // ...
    if (data.reportDate) {
        reportDate = data.reportDate;
    }
    // ...
}
```

#### تحديث معالجة الملفات:
```javascript
// في دالة معالجة الملفات
if (i === 0) { // أول ملف فقط
    const extractedDate = extractDateFromFirstRow(rawData);
    reportDate = extractedDate;
    console.log(`Extracted report date: ${reportDate}`);
}
```

### 2. في ملف `secret-visitor-details.html`

#### قراءة التاريخ من localStorage:
```javascript
const reportDate = store.reportDate || '';
```

#### إضافة دالة تحويل التاريخ إلى الإنجليزية:
```javascript
function convertDateToEnglish(arabicDate) {
    // تحويل التاريخ العربي إلى الإنجليزية
}
```

#### تحديث عرض التاريخ:
```javascript
if (reportSubtitle) {
    if (currentLang === 'en') {
        const englishDate = convertDateToEnglish(reportDate);
        reportSubtitle.textContent = englishDate;
    } else {
        reportSubtitle.textContent = reportDate;
    }
}
```

## الأنماط المدعومة للتاريخ

### الأنماط العربية:
- `لسنة 2024 شهر أكتوبر`
- `سنة 2024 شهر أكتوبر`
- `2024 شهر أكتوبر`
- `شهر أكتوبر سنة 2024`
- `شهر أكتوبر 2024`

### الأنماط الإنجليزية:
- `For October 2024`
- `October 2024`
- `Year 2024 Month October`
- `Month October Year 2024`

### الأشهر المدعومة:
- **عربية**: يناير، فبراير، مارس، أبريل، مايو، يونيو، يوليو، أغسطس، سبتمبر، أكتوبر، نوفمبر، ديسمبر
- **إنجليزية**: January, February, March, April, May, June, July, August, September, October, November, December

## كيفية العمل

1. **رفع ملف الإكسل**: عند رفع ملف إكسل في صفحة الزائر السري
2. **استخراج التاريخ**: يتم البحث في أول سطر عن أنماط التاريخ المدعومة
3. **حفظ التاريخ**: يتم حفظ التاريخ المستخرج في localStorage
4. **عرض التاريخ**: في صفحة التفاصيل، يتم عرض التاريخ المستخرج بدلاً من التاريخ الثابت
5. **دعم اللغات**: يتم تحويل التاريخ إلى الإنجليزية عند تغيير اللغة

## اختبار الميزة

تم إنشاء ملف `test-date-extraction.html` لاختبار دالة استخراج التاريخ:

1. افتح الملف في المتصفح
2. اختر ملف إكسل يحتوي على تاريخ في أول سطر
3. اضغط على "اختبار استخراج التاريخ"
4. ستظهر النتيجة والتاريخ المستخرج

## مثال على الاستخدام

إذا كان أول سطر في ملف الإكسل يحتوي على:
```
لسنة 2024 شهر نوفمبر
```

سيتم استخراج التاريخ وعرضه في صفحة التفاصيل كـ:
```
لسنة 2024 شهر نوفمبر
```

وفي اللغة الإنجليزية:
```
For November 2024
```

## ملاحظات مهمة

- يتم استخراج التاريخ من أول ملف إكسل فقط في حالة رفع عدة ملفات
- إذا لم يتم العثور على تاريخ في أول سطر، لن يتم عرض أي تاريخ
- التاريخ المستخرج يتم حفظه في localStorage ويبقى حتى يتم رفع ملف جديد
- الميزة تدعم كلاً من التاريخ العربي والإنجليزي
