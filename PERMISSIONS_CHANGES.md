# تعديلات صفحة الصلاحيات

## ملخص التعديلات

تم تعديل صفحة الصلاحيات بحيث تظهر الأدوار المختلفة حسب دور المستخدم المسجل دخوله:

### للأدمن العادي (Admin)
- يظهر فقط **الموظفين** في جدول الأدوار
- يمكنه تعديل صلاحيات الموظفين فقط

### لسوبر أدمن (Super Admin)
- يظهر فقط **المدراء** في جدول الأدوار
- يمكنه تعديل صلاحيات المدراء فقط

### للموظف العادي (Employee)
- لا يظهر أي أدوار في الجدول
- رسالة توضح أنه لا توجد أدوار متاحة لإدارتها

## الملفات المعدلة

### 1. `admin/permissions.html`
- إزالة الأدوار الثابتة من الجدول
- إضافة عنصر لعرض دور المستخدم الحالي
- تحويل جدول الأدوار ليكون ديناميكي

### 2. `admin/permissions.js`
- إضافة دالة `getCurrentUserInfo()` لجلب معلومات المستخدم
- إضافة دالة `updateUserRoleDisplay()` لعرض دور المستخدم
- إضافة دالة `loadRolesBasedOnUserRole()` لتحميل الأدوار حسب دور المستخدم
- تعديل دالة `updateRolesTable()` لتستخدم ID محدد
- إضافة رسالة عندما لا توجد أدوار متاحة

### 3. `admin/permissions.css`
- إضافة CSS لعرض دور المستخدم في أعلى الصفحة
- تصميم جميل لعرض الدور مع gradient background

### 4. `backend/controllers/authController.js`
- تعديل دالة `getCurrentUser()` لإضافة أعلام الدور (`isSuperAdmin`, `isAdmin`)

## كيفية العمل

1. **عند تحميل الصفحة**: يتم جلب معلومات المستخدم الحالي من `/api/auth/me`
2. **تحديد الأدوار المتاحة**: حسب دور المستخدم:
   - سوبر أدمن → المدراء فقط
   - أدمن عادي → الموظفين فقط
   - موظف عادي → لا شيء
3. **عرض الأدوار**: يتم تحديث الجدول ديناميكياً بالأدوار المتاحة
4. **عرض دور المستخدم**: يتم عرض دور المستخدم الحالي في أعلى الصفحة

## الاختبار

تم إنشاء ملف `test-permissions.html` لاختبار الوظائف:
- اختبار جلب معلومات المستخدم
- اختبار تحميل الأدوار حسب دور المستخدم
- محاكاة تسجيل دخول بأدوار مختلفة

## الأمان

- يتم التحقق من التوكن في كل طلب
- يتم التحقق من صلاحيات المستخدم قبل عرض الأدوار
- لا يمكن للمستخدم الوصول لأدوار لا يملك صلاحية إدارتها

## التوافق

- يعمل مع النظام الحالي بدون تغييرات في قاعدة البيانات
- يحافظ على جميع الوظائف الموجودة
- يدعم اللغتين العربية والإنجليزية
