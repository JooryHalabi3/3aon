# ميزة الدخول كموظف - نظام إدارة الموظفين

## 🎯 نظرة عامة

تم إضافة ميزة جديدة تسمح للمديرين (Admin/Super Admin) بالدخول إلى حسابات الموظفين الأخرى لاختبار النظام أو مساعدتهم في حل المشاكل. هذه الميزة تتضمن تتبع كامل لجميع الإجراءات في سجل النظام.

## 🔧 الميزات المضافة

### 1. عرض بيانات الموظفين
- **جدول تفاعلي**: عرض جميع بيانات الموظفين من قاعدة البيانات
- **إحصائيات فورية**: عدد الموظفين النشطين، الأقسام، المديرين
- **فلترة متقدمة**: حسب القسم، الدور، الحالة، والبحث النصي

### 2. الدخول كموظف (Login as Employee)
- **زر "دخول"**: لكل موظف في الجدول
- **تأكيد الأمان**: رسالة تأكيد قبل الدخول
- **تسجيل الإجراء**: تتبع كامل في سجل النظام
- **إعادة توجيه ذكية**: حسب دور الموظف

### 3. إدارة الموظفين
- **تعديل البيانات**: تحديث معلومات الموظفين
- **حذف الموظفين**: تحديث الحالة إلى غير نشط
- **إضافة موظفين**: إضافة موظفين جدد (قيد التطوير)

### 4. نظام التتبع والأمان
- **سجل النظام**: تتبع جميع الإجراءات
- **تسجيل IP**: تتبع عنوان IP للمستخدم
- **صلاحيات محددة**: فقط المديرين يمكنهم الدخول كموظفين

## 🎨 واجهة المستخدم

### صفحة بيانات الموظفين
- **الإحصائيات**: 4 بطاقات تعرض الإحصائيات المهمة
- **الفلاتر**: فلترة حسب القسم، الدور، الحالة، والبحث
- **الجدول**: عرض منظم لجميع بيانات الموظفين
- **أزرار الإجراءات**: دخول، تعديل، حذف لكل موظف

### التصميم
- **الألوان**: أخضر لزر الدخول، أصفر للتعديل، أحمر للحذف
- **التجاوب**: يعمل على جميع أحجام الشاشات
- **الأنيميشن**: انتقالات سلسة

## 🔄 خطوات الاستخدام

### 1. الوصول للصفحة
```
افتح: http://localhost:3001/admin/employee-data.html
```

### 2. عرض بيانات الموظفين
```
- ستظهر جميع بيانات الموظفين في الجدول
- يمكن استخدام الفلاتر للبحث
- الإحصائيات محدثة تلقائياً
```

### 3. الدخول كموظف
```
1. انقر على زر "دخول" بجانب الموظف المطلوب
2. أكد الإجراء في النافذة المنبثقة
3. سيتم تسجيل الإجراء في السجل
4. سيتم إعادة توجيهك للصفحة المناسبة حسب دور الموظف
```

### 4. إدارة الموظفين
```
- تعديل: انقر على زر "تعديل" (قيد التطوير)
- حذف: انقر على زر "حذف" لتحديث الحالة إلى غير نشط
```

## 🛠️ التقنيات المستخدمة

### Frontend
- **HTML**: جدول تفاعلي مع أزرار الإجراءات
- **CSS**: تصميم متجاوب مع ألوان مميزة
- **JavaScript**: تفاعل ديناميكي مع API

### Backend
- **API Endpoints**:
  - `GET /api/admin/employees` - جلب جميع الموظفين
  - `GET /api/admin/employees/stats` - جلب إحصائيات الموظفين
  - `POST /api/admin/employees/:id/login-as` - الدخول كموظف
  - `PUT /api/admin/employees/:id` - تحديث بيانات الموظف
  - `DELETE /api/admin/employees/:id` - حذف الموظف

### Database
- **الجداول المستخدمة**: `employees`, `departments`, `system_logs`
- **العلاقات**: Foreign Keys بين الجداول
- **الفهارس**: لتحسين الأداء

## 📊 البيانات المحدثة

### عند الدخول كموظف:
1. **إنشاء JWT Token**: token جديد للموظف
2. **تسجيل في السجل**: إضافة سجل في `system_logs`
3. **حفظ البيانات**: حفظ token وبيانات الموظف في localStorage

### عند حذف موظف:
1. **تحديث الحالة**: تحديث `Status` إلى 'inactive'
2. **تسجيل في السجل**: إضافة سجل في `system_logs`
3. **تحديث الإحصائيات**: إعادة حساب الإحصائيات

## 🔒 الأمان والصلاحيات

### التحقق من الصلاحيات
- **Super Admin (RoleID = 1)**: يمكن الدخول كأي موظف
- **Admin (RoleID = 2)**: يمكن الدخول كأي موظف
- **Employee (RoleID = 3)**: لا يمكن الوصول لهذه الميزة

### التحقق من البيانات
- التحقق من وجود الموظف
- التحقق من حالة الموظف (نشط)
- التحقق من صلاحيات المدير

### التتبع والأمان
- **تسجيل IP**: تتبع عنوان IP للمستخدم
- **تسجيل الإجراءات**: جميع الإجراءات مسجلة
- **Token محدود**: token الدخول صالح لمدة ساعة واحدة

## 🐛 استكشاف الأخطاء

### مشاكل شائعة:
1. **لا تظهر بيانات الموظفين**: تحقق من اتصال قاعدة البيانات
2. **خطأ في الدخول**: تحقق من صلاحيات المستخدم
3. **لا يتم إعادة التوجيه**: تحقق من دور الموظف

### رسائل الخطأ:
- "الموظف غير موجود أو غير نشط" - الموظف محذوف أو غير نشط
- "ليس لديك صلاحية للدخول كموظف آخر" - المستخدم ليس مدير
- "خطأ في الخادم" - مشكلة في قاعدة البيانات

## 📱 التوافق

### المتصفحات المدعومة:
- Chrome (الإصدار 80+)
- Firefox (الإصدار 75+)
- Safari (الإصدار 13+)
- Edge (الإصدار 80+)

### الأجهزة المدعومة:
- أجهزة الكمبيوتر المكتبية
- أجهزة الكمبيوتر المحمولة
- الأجهزة اللوحية
- الهواتف الذكية

## 🚀 التحسينات المستقبلية

### ميزات مقترحة:
1. **موديل التعديل**: واجهة منبثقة لتعديل بيانات الموظفين
2. **موديل الإضافة**: إضافة موظفين جدد
3. **تصدير البيانات**: تصدير بيانات الموظفين بصيغ مختلفة
4. **بحث متقدم**: بحث في جميع الحقول
5. **فرز الجدول**: إمكانية ترتيب البيانات حسب أي عمود

## 📁 الملفات المحدثة

### Backend Files
- `backend/routes/adminRoutes.js` - إضافة endpoints جديدة

### Frontend Files
- `admin/employee-data.js` - إضافة وظائف إدارة الموظفين
- `admin/employee-data.css` - إضافة تصميم أزرار الدخول
- `admin/employee-data.html` - تحديث الجدول وإضافة الأزرار

### Database Files
- `database_updates.sql` - إضافة جدول system_logs

---

**تم تطوير هذه الميزة بواسطة فريق عونك** 🏥  
**تاريخ الإضافة**: ديسمبر 2024
